"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("./index.3840a89d.js"),a=require("./md5.e62adc35.js"),r=require("./WindowAction.4eff913a.js"),l=require("./useDelayTime.c75a4cd7.js"),t=require("./Input.3f4c4aa8.js");function o(){const a=e.useMessage(),{t:r}=e.useLocale(),l=Object.keys(e.ErrorCode),t=e.computed((()=>[{code:e.ErrorCode.ERR_NETWORK,message:r("Network Error")}]));return{handleError:e=>{if(l.includes(e)){const r=(e=>t.value.find((a=>a.code===e)))(e);(null==r?void 0:r.message)&&a.error(r.message)}}}}const n={class:"window-drag"},s={class:"login_logo"},u=(a=>(e.pushScopeId("data-v-15e51d22"),a=a(),e.popScopeId(),a))((()=>e.createBaseVNode("img",{src:a._imports_0,alt:""},null,-1))),d={class:"login-box"},i={class:"login-title"},c={class:"flex jc-around buttons"},f=e.defineComponent({__name:"login",setup(f){const p=e.useRouter(),{fetchTranslateServe:g,translateServeList:v,isFetchLoading:m}=e.useTranslate(),{renderLabel:h,fetchDelayTime:w}=l.useDelayTime(),{handleError:N}=o(),{loginFormModel:b}=e.useDefault(),y=e.ref({username:"",password:""}),{t:S,setLocale:V}=e.useLocale(),C=e.ref(null),x=e.computed$1((()=>({username:{required:!0,message:S("please enter user name"),trigger:"blur"},password:{required:!0,message:S("Please enter your password"),trigger:"blur"},translateServe:{required:!0,message:S("Please select a translation server"),trigger:"blur"},locale:{required:!0,message:S("Please select a login language"),trigger:"blur"}}))),{electron:_,skipOuterLink:E}=e.useElectron(),L=e.useAppStore(),T=e.useKeyStore(),k=e.useUserStore(),{handleMessage:B}=function(){const{t:a}=e.useLocale();return{handleMessage:(e,r,l,t)=>{!function(e,a,r){e?null==a||a():null==r||r()}("boolean"==typeof e?e:0===e,(()=>{null==l||l()}),(()=>{4e3===e?window.$message.error(a("Network error")):r&&window.$message.error(r),null==t||t()}))}}}(),I=()=>{var r;null==(r=C.value)||r.validate((async r=>{if(r)return;const{username:l,password:t}=y.value;e.Cache.set(e.CacheKey.SERVER_URL,y.value.translateServe);try{const{code:r,message:o,data:n}=await e.login({username:l,password:t});B(r,o,(()=>{k.setUserInfo(n),T.refreshKey(),L.refreshApp(),k.setLock(!1),_.initUserInfo(n),_.setConfigDataByKey("translateServe",y.value.translateServe),_.setConfigDataByKey("locale",y.value.locale),e.Cache.set(e.CacheKey.TOKEN,n.token),e.Cache.set(e.CacheKey.PASSWORD,a.md5.exports(y.value.password)),setTimeout((()=>{_.handleWindow("customResizeWindow"),p.push({name:"layout"})}),100)}))}catch(o){N(null==o?void 0:o.code)}}))},R=e.ref();_.getVersion().then((e=>{R.value=e}));const D=e=>{e&&(y.value.translateServe=e)},K=e=>{y.value.locale=e,V(e,!0)};return e.onMounted((async()=>{y.value=Object.assign({},y.value,b),await g(),await w(D)})),(a,o)=>{const f=e.resolveComponent("base-layout");return e.openBlock(),e.createBlock(f,{class:"flex-d ai-center justify-center bg-setting"},{default:e.withCtx((()=>[e.createBaseVNode("div",n,[e.createVNode(r.WindowAction)]),e.createBaseVNode("div",s,[u,e.createBaseVNode("span",null," v"+e.toDisplayString(R.value),1)]),e.createBaseVNode("div",d,[e.createBaseVNode("div",i,e.toDisplayString(e.unref(S)("Login please"))+" LookWorld！",1),e.createVNode(e.unref(l.NForm),{"show-require-mark":!1,ref_key:"formRef",ref:C,model:y.value,"label-placement":"left","label-width":90,rules:e.unref(x)},{default:e.withCtx((()=>[e.createVNode(e.unref(l.NFormItem),{label:e.unref(S)("Username"),path:"username"},{default:e.withCtx((()=>[e.createVNode(e.unref(t.NInput),{value:y.value.username,"onUpdate:value":o[0]||(o[0]=e=>y.value.username=e),placeholder:e.unref(S)("Enter your user name")},null,8,["value","placeholder"])])),_:1},8,["label"]),e.createVNode(e.unref(l.NFormItem),{label:e.unref(S)("Password"),path:"password"},{default:e.withCtx((()=>[e.createVNode(e.unref(t.NInput),{type:"password",value:y.value.password,"onUpdate:value":o[1]||(o[1]=e=>y.value.password=e),placeholder:e.unref(S)("Enter password"),onKeydown:e.withKeys(I,["enter"])},null,8,["value","placeholder","onKeydown"])])),_:1},8,["label"]),e.createVNode(e.unref(l.NFormItem),{label:e.unref(S)("Translation server"),path:"translateServe"},{default:e.withCtx((()=>[e.createVNode(e.unref(l.NSelect),{class:"m-left","label-field":"name","value-field":"serveUrl",value:y.value.translateServe,"onUpdate:value":o[2]||(o[2]=e=>y.value.translateServe=e),options:e.unref(v),placeholder:e.unref(S)("Translation server"),filterable:"",to:!1,"render-label":e.unref(h)},null,8,["value","options","placeholder","render-label"])])),_:1},8,["label"]),e.createVNode(e.unref(l.NFormItem),{label:e.unref(S)("language"),path:"locale"},{default:e.withCtx((()=>[e.createVNode(e.unref(l.NSelect),{class:"m-left","label-field":"label","value-field":"locale",value:y.value.locale,"onUpdate:value":o[3]||(o[3]=e=>y.value.locale=e),options:e.unref(e.languageList),placeholder:e.unref(S)("language"),filterable:"","on-update:value":K},null,8,["value","options","placeholder"])])),_:1},8,["label"]),e.createVNode(e.unref(l.NFormItem),null,{default:e.withCtx((()=>[e.createVNode(e.unref(e.NButton),{onClick:I,class:"w100 register",disabled:e.unref(m)},{default:e.withCtx((()=>[e.createTextVNode(e.toDisplayString(e.unref(S)("Login")),1)])),_:1},8,["disabled"])])),_:1}),e.createBaseVNode("div",c,[e.createVNode(e.unref(e.NButton),{class:"btn",onClick:o[4]||(o[4]=a=>e.unref(E)(`${e.unref(e.homepage)}/login?id=${e.unref(e.HomepageLogin).REGISTER}`)),text:""},{default:e.withCtx((()=>[e.createTextVNode(e.toDisplayString(e.unref(S)("Sign up now")),1)])),_:1}),e.createVNode(e.unref(e.NButton),{class:"btn",onClick:o[5]||(o[5]=a=>e.unref(E)(`${e.unref(e.homepage)}/login?id=${e.unref(e.HomepageLogin).FORGET_PASSWORD}`)),text:""},{default:e.withCtx((()=>[e.createTextVNode(e.toDisplayString(e.unref(S)("Forgot password")),1)])),_:1})])])),_:1},8,["model","rules"])])])),_:1})}}}),p=e._export_sfc(f,[["__scopeId","data-v-15e51d22"]]);exports.default=p;
